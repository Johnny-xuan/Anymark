# 问题分析工作流

当遇到 bug 或错误时，按此流程进行深度分析。

## 阶段 1：收集信息

### 1.1 明确问题表象

```
问题描述：_______________
错误信息：_______________
出现位置：_______________（文件/行号/组件）
复现步骤：_______________
是否必现：[ ] 必现  [ ] 偶发
```

### 1.2 确定问题类型

| 类型 | 特征 | 优先检查 |
|------|------|---------|
| 编译错误 | npm run build 失败 | 导入路径、类型定义、配置文件 |
| 类型错误 | TypeScript 报错 | 类型定义文件、接口定义 |
| 运行时错误 | 控制台报错 | 数据流、异步处理、边界条件 |
| 逻辑错误 | 功能不符合预期 | 业务逻辑、状态管理 |
| 性能问题 | 卡顿、慢 | 渲染次数、数据量、算法复杂度 |

## 阶段 2：建立上下文

### 2.1 定位涉及的功能

```
这个问题影响的用户功能是：_______________
这个功能的核心流程是：_______________
涉及的主要模块/文件：_______________
```

### 2.2 理解数据流

```
数据从哪里来？ → _______________
经过哪些处理？ → _______________
最终到哪里去？ → _______________
问题出在哪个环节？ → _______________
```

### 2.3 检查依赖关系

```
这个文件依赖哪些模块？
- _______________
- _______________

哪些模块依赖这个文件？
- _______________
- _______________
```

## 阶段 3：分层分析

### 第一层：表面问题
- [ ] 错误信息具体是什么？
- [ ] 错误发生在哪个文件的哪一行？
- [ ] 是编译时错误还是运行时错误？

### 第二层：代码上下文
- [ ] 相关的类型定义是否正确？
- [ ] 变量/函数的输入输出是否符合预期？
- [ ] 是否有空值/undefined 没有处理？

### 第三层：模块交互
- [ ] 模块间的接口定义是否一致？
- [ ] 数据传递过程中是否有转换错误？
- [ ] 异步操作的时序是否正确？

### 第四层：架构层面
- [ ] 这个问题是设计缺陷还是实现 bug？
- [ ] 是否需要重构而不是打补丁？
- [ ] 修复后会不会影响其他功能？

## 阶段 4：根因定位

### 4.1 排除法

```
假设 1：_______________
验证方法：_______________
结果：[ ] 确认  [ ] 排除

假设 2：_______________
验证方法：_______________
结果：[ ] 确认  [ ] 排除

假设 3：_______________
验证方法：_______________
结果：[ ] 确认  [ ] 排除
```

### 4.2 确认根因

```
根本原因：_______________
为什么会出现这个问题：_______________
影响范围：_______________
```

## 阶段 5：制定修复方案

### 5.1 方案评估

```
方案 A：_______________
优点：_______________
缺点：_______________
影响范围：_______________

方案 B：_______________
优点：_______________
缺点：_______________
影响范围：_______________
```

### 5.2 选择最优方案

```
选择方案：_______________
选择理由：_______________
需要修改的文件：
- _______________
- _______________
```

## 阶段 6：实施与验证

### 6.1 修复前检查
- [ ] 已理解问题的根本原因
- [ ] 已评估对其他模块的影响
- [ ] 修复方案是解决根因而非症状

### 6.2 修复后验证
- [ ] 原问题已解决
- [ ] 相关功能仍然正常
- [ ] 没有引入新的问题
- [ ] 类型检查通过
- [ ] 测试通过

## 常见陷阱

### 陷阱 1：只看错误信息
```
❌ 错误说 "undefined is not a function"，就去加 null 检查
✅ 追溯为什么这里会是 undefined，从源头解决
```

### 陷阱 2：复制粘贴修复
```
❌ 网上搜到类似问题，直接复制答案
✅ 理解答案的原理，确认适用于当前场景
```

### 陷阱 3：过度修复
```
❌ 为了修一个 bug，重构了半个项目
✅ 最小化修改，只改必要的部分
```

### 陷阱 4：忽略副作用
```
❌ 改完就提交，没有测试相关功能
✅ 验证修复没有破坏其他功能
```

## 调试技巧

### 二分法定位
1. 找到问题最后正常的版本
2. 找到问题首次出现的版本
3. 在中间版本检查
4. 重复直到定位到具体改动

### 最小复现
1. 创建最简单的复现场景
2. 逐步添加复杂度
3. 找到触发问题的最小条件

### 日志追踪
1. 在关键节点添加日志
2. 追踪数据流转过程
3. 找到数据变异的位置
